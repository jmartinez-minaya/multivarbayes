<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multivariate linear regression • multivarbayes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate linear regression">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multivarbayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/multivarbayes-vignette.html">Multivariate linear regression</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multivariate linear regression</h1>
                        <h4 data-toc-skip class="author">Joaquín
Martínez-Minaya</h4>
            
      

      <div class="d-none name"><code>multivarbayes-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates how to use the
<strong>multivarbayes</strong> package to fit a Bayesian multivariate
linear regression model, summarize the results, plot the posterior
distributions, and make predictions on new data.</p>
<div class="section level3">
<h3 id="example-usage">Example Usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h3>
</div>
<div class="section level3">
<h3 id="generate-example-data">Generate Example Data<a class="anchor" aria-label="anchor" href="#generate-example-data"></a>
</h3>
<p>We generate some example data with an intercept term and multivariate
normal errors.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>  <span class="co"># number of observations</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">3</span>    <span class="co"># number of covariates (including intercept)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">2</span>    <span class="co"># number of response variables</span></span>
<span><span class="va">nsims</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate matrix with intercept</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="op">(</span><span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">k</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># True coefficients</span></span>
<span><span class="va">B_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.3</span>, <span class="fl">2</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Multivariate normal errors</span></span>
<span><span class="va">Sigma_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span>
<span><span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">n</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">m</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">Sigma_true</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response matrix</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">B_true</span> <span class="op">+</span> <span class="va">errors</span>  </span>
<span></span>
<span><span class="co"># Combine into data frame</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>, <span class="st">"Y2"</span>, <span class="st">"Intercept"</span>, <span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-the-model">Fit the Model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h3>
<p>We fit the model using the <code>mlvr</code> function and the formula
interface.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>, <span class="st">"Y2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">~</span>  <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span></span>
<span><span class="va">model_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mlvr.html">mlvr</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="va">model_fit</span><span class="op">$</span><span class="va">analytic</span></span></code></pre></div>
<pre><code><span><span class="co">## $B_n</span></span>
<span><span class="co">##                     Y1         Y2</span></span>
<span><span class="co">## (Intercept)  0.9873563  1.9759494</span></span>
<span><span class="co">## X1           0.4835896 -0.5181053</span></span>
<span><span class="co">## X2          -0.2735044  1.0172392</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $V_n</span></span>
<span><span class="co">##          Y1        Y2</span></span>
<span><span class="co">## Y1 920.5009  277.9382</span></span>
<span><span class="co">## Y2 277.9382 1018.2380</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $df</span></span>
<span><span class="co">## [1] 1003</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $cov_matrix</span></span>
<span><span class="co">##               [,1]          [,2]          [,3]          [,4]          [,5]</span></span>
<span><span class="co">## [1,]  9.185982e-04 -1.176349e-05 -3.719340e-05  2.773637e-04 -3.551897e-06</span></span>
<span><span class="co">## [2,] -1.176349e-05  9.401850e-04 -7.978100e-05 -3.551897e-06  2.838817e-04</span></span>
<span><span class="co">## [3,] -3.719340e-05 -7.978100e-05  9.070306e-04 -1.123026e-05 -2.408926e-05</span></span>
<span><span class="co">## [4,]  2.773637e-04 -3.551897e-06 -1.123026e-05  1.016133e-03 -1.301252e-05</span></span>
<span><span class="co">## [5,] -3.551897e-06  2.838817e-04 -2.408926e-05 -1.301252e-05  1.040012e-03</span></span>
<span><span class="co">## [6,] -1.123026e-05 -2.408926e-05  2.738710e-04 -4.114252e-05 -8.825201e-05</span></span>
<span><span class="co">##               [,6]</span></span>
<span><span class="co">## [1,] -1.123026e-05</span></span>
<span><span class="co">## [2,] -2.408926e-05</span></span>
<span><span class="co">## [3,]  2.738710e-04</span></span>
<span><span class="co">## [4,] -4.114252e-05</span></span>
<span><span class="co">## [5,] -8.825201e-05</span></span>
<span><span class="co">## [6,]  1.003338e-03</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="summarize-the-fitted-model">Summarize the Fitted Model<a class="anchor" aria-label="anchor" href="#summarize-the-fitted-model"></a>
</h3>
<p>We can summarize the fitted model to inspect the posterior
distributions of the coefficients and the scale matrix of Sigma.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## ######## &lt;--- Fixed effects parameters (Marginal of B | Y, X): ---&gt; ###########</span></span>
<span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response variable:  Y1 </span></span>
<span><span class="co">##                   mean         sd q0.025.2.5%   q0.5.50% q0.975.97.5%</span></span>
<span><span class="co">## (Intercept)  0.9882101 0.02944316   0.9335146  0.9878259    1.0473071</span></span>
<span><span class="co">## X1           0.4841381 0.03035238   0.4267144  0.4839449    0.5459440</span></span>
<span><span class="co">## X2          -0.2724936 0.02910453  -0.3279768 -0.2735268   -0.2150985</span></span>
<span><span class="co">##                   mode</span></span>
<span><span class="co">## (Intercept)  0.9870151</span></span>
<span><span class="co">## X1           0.4867613</span></span>
<span><span class="co">## X2          -0.2750810</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response variable:  Y2 </span></span>
<span><span class="co">##                   mean         sd q0.025.2.5%   q0.5.50% q0.975.97.5%</span></span>
<span><span class="co">## (Intercept)  1.9750329 0.03313062   1.9085149  1.9748964    2.0390554</span></span>
<span><span class="co">## X1          -0.5182408 0.03037799  -0.5799787 -0.5185471   -0.4579699</span></span>
<span><span class="co">## X2           1.0171430 0.03244027   0.9549307  1.0184422    1.0824680</span></span>
<span><span class="co">##                   mode</span></span>
<span><span class="co">## (Intercept)  1.9693254</span></span>
<span><span class="co">## X1          -0.5128016</span></span>
<span><span class="co">## X2           1.0246825</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## ###############  &lt;--- Hyperparameters (Covariance Matrix): ---&gt; ###############</span></span>
<span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                mean         sd q0.025.2.5%  q0.5.50% q0.975.97.5%      mode</span></span>
<span><span class="co">## sigma2_1  0.9205045 0.04200995   0.8475987 0.9182751    1.0120416 0.9117627</span></span>
<span><span class="co">## sigma2_12 0.2787608 0.03228799   0.2153344 0.2782053    0.3443851 0.2799257</span></span>
<span><span class="co">## sigma2_2  1.0180927 0.04545909   0.9328351 1.0173819    1.1121817 1.0058404</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plot-posterior-distributions">Plot Posterior Distributions<a class="anchor" aria-label="anchor" href="#plot-posterior-distributions"></a>
</h3>
<p>To visualize the posterior distributions of the coefficients, we can
use the <code>plot</code> method.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $fixed_effects_plot</span></span></code></pre>
<p><img src="multivarbayes-vignette_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## $hyperparameter_plot</span></span></code></pre>
<p><img src="multivarbayes-vignette_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## ######## &lt;--- Fixed effects parameters (Marginal of B | Y, X): ---&gt; ###########</span></span>
<span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response variable:  Y1 </span></span>
<span><span class="co">##                   mean         sd q0.025.2.5%   q0.5.50% q0.975.97.5%</span></span>
<span><span class="co">## (Intercept)  0.9882101 0.02944316   0.9335146  0.9878259    1.0473071</span></span>
<span><span class="co">## X1           0.4841381 0.03035238   0.4267144  0.4839449    0.5459440</span></span>
<span><span class="co">## X2          -0.2724936 0.02910453  -0.3279768 -0.2735268   -0.2150985</span></span>
<span><span class="co">##                   mode</span></span>
<span><span class="co">## (Intercept)  0.9870151</span></span>
<span><span class="co">## X1           0.4867613</span></span>
<span><span class="co">## X2          -0.2750810</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response variable:  Y2 </span></span>
<span><span class="co">##                   mean         sd q0.025.2.5%   q0.5.50% q0.975.97.5%</span></span>
<span><span class="co">## (Intercept)  1.9750329 0.03313062   1.9085149  1.9748964    2.0390554</span></span>
<span><span class="co">## X1          -0.5182408 0.03037799  -0.5799787 -0.5185471   -0.4579699</span></span>
<span><span class="co">## X2           1.0171430 0.03244027   0.9549307  1.0184422    1.0824680</span></span>
<span><span class="co">##                   mode</span></span>
<span><span class="co">## (Intercept)  1.9693254</span></span>
<span><span class="co">## X1          -0.5128016</span></span>
<span><span class="co">## X2           1.0246825</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## ###############  &lt;--- Hyperparameters (Covariance Matrix): ---&gt; ###############</span></span>
<span><span class="co">## ###############################################################################</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                mean         sd q0.025.2.5%  q0.5.50% q0.975.97.5%      mode</span></span>
<span><span class="co">## sigma2_1  0.9205045 0.04200995   0.8475987 0.9182751    1.0120416 0.9117627</span></span>
<span><span class="co">## sigma2_12 0.2787608 0.03228799   0.2153344 0.2782053    0.3443851 0.2799257</span></span>
<span><span class="co">## sigma2_2  1.0180927 0.04545909   0.9328351 1.0173819    1.1121817 1.0058404</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B_true</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2]</span></span>
<span><span class="co">## [1,]  1.0  2.0</span></span>
<span><span class="co">## [2,]  0.5 -0.5</span></span>
<span><span class="co">## [3,] -0.3  1.0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="predict-new-observations">Predict New Observations<a class="anchor" aria-label="anchor" href="#predict-new-observations"></a>
</h3>
<p>Finally, we can use the <code>predict</code> function to predict
responses for new observations based on the fitted model.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example usage:</span></span>
<span><span class="co"># Assuming model_fit is the fitted object and newdata is the new data to predict on</span></span>
<span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>  <span class="co"># New covariate values</span></span>
<span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">newdata_real</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y1"</span>, <span class="st">"Y2"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_fit</span>, newdata <span class="op">=</span> <span class="va">newdata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">predictions</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            Length Class  Mode</span></span>
<span><span class="co">## summary    2      -none- list</span></span>
<span><span class="co">## analytical 3      -none- list</span></span>
<span><span class="co">## marginals  2      -none- list</span></span></code></pre>
<p>In this final part, we compare the theoretical predictive
distribution with the simulated predictive distribution, as well as with
the actual observed values. This allows us to visually inspect how well
the model captures the underlying data distribution and the uncertainty
associated with it.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Suppose `predictions` is the object containing the results obtained from the `predict.mlvr` function</span></span>
<span><span class="co"># and `newdata_real` holds the actual values for each predicted individual.</span></span>
<span><span class="co"># Extract necessary elements from predictions</span></span>
<span><span class="va">analytic_mean</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">analytic</span><span class="op">$</span><span class="va">mean</span>          <span class="co"># Theoretical predictive mean</span></span>
<span><span class="va">analytic_cov</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">analytic</span><span class="op">$</span><span class="va">cov_matrix</span>     <span class="co"># Theoretical predictive covariance</span></span>
<span><span class="va">predictive_samples</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">marginals</span>         <span class="co"># Simulated predictive samples</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">analytic</span><span class="op">$</span><span class="va">df</span>                       <span class="co"># Degrees of freedom for the t-Student distribution</span></span>
<span><span class="va">newdata_real</span> <span class="op">&lt;-</span> <span class="va">newdata_real</span>                        <span class="co"># Actual values provided</span></span>
<span></span>
<span><span class="co"># Create a data frame to store simulated predictive samples</span></span>
<span><span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">analytic_mean</span><span class="op">)</span>                        <span class="co"># Number of observations in newdata</span></span>
<span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">predictive_samples</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>             <span class="co"># Number of simulations (assume all responses have the same number of simulations)</span></span>
<span><span class="va">n_responses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">predictive_samples</span><span class="op">)</span>           <span class="co"># Number of response variables</span></span>
<span></span>
<span><span class="co"># Build the data frame for simulated predictive samples</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">resp</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_responses</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">obs</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_obs</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sim_values</span> <span class="op">&lt;-</span> <span class="va">predictive_samples</span><span class="op">[[</span><span class="va">resp</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">obs</span>, <span class="op">]</span>  <span class="co"># Simulated samples for the response variable and observation</span></span>
<span>    <span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      Observation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Obs_"</span>, <span class="va">obs</span><span class="op">)</span>,             <span class="co"># Observation label</span></span>
<span>      Response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="va">resp</span><span class="op">)</span>,                  <span class="co"># Response variable name</span></span>
<span>      Value <span class="op">=</span> <span class="va">sim_values</span>,                            <span class="co"># Simulated samples</span></span>
<span>      Group <span class="op">=</span> <span class="st">"Simulated"</span>                            <span class="co"># Group label</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">simulated_data</span>, <span class="va">sim_df</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a data frame for theoretical densities</span></span>
<span><span class="va">theoretical_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate theoretical density for each observation and response variable</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">obs</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_obs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">resp</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_responses</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mean_val</span> <span class="op">&lt;-</span> <span class="va">analytic_mean</span><span class="op">[</span><span class="va">obs</span>, <span class="va">resp</span><span class="op">]</span>          <span class="co"># Theoretical mean for the response variable</span></span>
<span>    <span class="va">var_val</span> <span class="op">&lt;-</span> <span class="va">analytic_cov</span><span class="op">[</span><span class="va">resp</span>, <span class="va">resp</span>, <span class="va">obs</span><span class="op">]</span>      <span class="co"># Variance for the response variable</span></span>
<span>    </span>
<span>    <span class="co"># Create a sequence of values to represent the theoretical density</span></span>
<span>    <span class="va">x_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">mean_val</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_val</span><span class="op">)</span>, <span class="va">mean_val</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_val</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Calculate density using the t-Student distribution</span></span>
<span>    <span class="va">dens_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x_vals</span> <span class="op">-</span> <span class="va">mean_val</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_val</span><span class="op">)</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">var_val</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Create a data frame to store theoretical densities</span></span>
<span>    <span class="va">theor_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      Observation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Obs_"</span>, <span class="va">obs</span><span class="op">)</span>,</span>
<span>      Response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="va">resp</span><span class="op">)</span>,</span>
<span>      Value <span class="op">=</span> <span class="va">x_vals</span>,</span>
<span>      Density <span class="op">=</span> <span class="va">dens_vals</span>,</span>
<span>      Group <span class="op">=</span> <span class="st">"Theoretical"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">theoretical_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">theoretical_data</span>, <span class="va">theor_df</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a data frame for the actual observed values</span></span>
<span><span class="va">real_values_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Observation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Obs_"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_obs</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_responses</span><span class="op">)</span>,  <span class="co"># Labeled observations</span></span>
<span>  Response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n_responses</span><span class="op">)</span>, times <span class="op">=</span> <span class="va">n_obs</span><span class="op">)</span>,       <span class="co"># Response variable name</span></span>
<span>  Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">newdata_real</span><span class="op">)</span><span class="op">)</span>,                              <span class="co"># Convert actual values to a vector</span></span>
<span>  Group <span class="op">=</span> <span class="st">"Real"</span>                                                   <span class="co"># Group label for "Real"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert simulated data to densities for plotting</span></span>
<span><span class="va">simulated_densities</span> <span class="op">&lt;-</span> <span class="va">simulated_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Observation</span>, <span class="va">Response</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">do</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">density_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">Value</span>, adjust <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span>  <span class="co"># Calculate density for simulated samples</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">density_data</span><span class="op">$</span><span class="va">x</span>, Density <span class="op">=</span> <span class="va">density_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>  <span class="co"># Store density values</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Group <span class="op">=</span> <span class="st">"Simulated"</span><span class="op">)</span>  <span class="co"># Label as "Simulated" for plotting</span></span>
<span></span>
<span><span class="co"># Combine theoretical and simulated densities into a single data frame</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">simulated_densities</span>, <span class="va">theoretical_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plots</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Histograms for simulated predictive samples</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">simulated_densities</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Value</span>, y <span class="op">=</span> <span class="va">Density</span>, color <span class="op">=</span> <span class="va">Group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Line for theoretical densities</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">theoretical_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Value</span>, y <span class="op">=</span> <span class="va">Density</span>, color <span class="op">=</span> <span class="va">Group</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Vertical line for actual observed values</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>data <span class="op">=</span> <span class="va">real_values_data</span>, <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">Value</span>, color <span class="op">=</span> <span class="va">Group</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">Response</span> <span class="op">~</span> <span class="va">Observation</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Facets by response and observation</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Predictive Distributions for Each Observation"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   <span class="co"># Colors for distributions and actual values</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution Types"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="multivarbayes-vignette_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joaquín Martínez-Minaya.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
